services:
  # FastAPI Web Service
  - type: web
    name: jobflow-api
    runtime: python
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: fastapi run app/main.py --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: 3.14.2
      - key: ALLOWED_ORIGINS
        sync: false
      - key: UPSTASH_REDIS_REST_URL
        sync: false
      - key: UPSTASH_REDIS_REST_TOKEN
        sync: false
      - key: UPSTASH_REDIS_PORT
        value: 6379
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
    healthCheckPath: /health

  # Celery Background Worker
  - type: worker
    name: jobflow-celery-worker
    runtime: python
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: celery -A worker.celery_app worker --loglevel=info --concurrency=1
    envVars:
      - key: PYTHON_VERSION
        value: 3.14.2
      - key: UPSTASH_REDIS_REST_URL
        sync: false
      - key: UPSTASH_REDIS_REST_TOKEN
        sync: false
      - key: UPSTASH_REDIS_PORT
        value: 6379
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
